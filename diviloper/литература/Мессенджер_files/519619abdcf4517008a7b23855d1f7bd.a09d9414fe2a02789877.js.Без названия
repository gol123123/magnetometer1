(self.webpackChunkvk=self.webpackChunkvk||[]).push([[56058],{337057:(e,t,n)=>{"use strict";n.d(t,{VkIndexer:()=>a});var a=function(){function e(e,t,n){this.delimiter=new RegExp("[\\s\\-\\.,\\\"\\'\\«\\(\\)\\[\\]\\{\\}\\#\\+\\?\\\\]+","g"),this.trimmer=new RegExp("^[\\s\\-\\.,\\\"\\'\\«\\(\\)\\[\\]\\{\\}\\+\\?\\\\]+|[\\s\\-,\\\"\\'\\«\\(\\)\\[\\]\\{\\}\\\\]+$","g"),this.toTranslit={1072:"a",1073:"b",1074:"v",1075:"g",1076:"d",1077:"e",1078:"zh",1079:"z",1080:"i",1081:"y",1082:"k",1083:"l",1084:"m",1085:"n",1086:"o",1087:"p",1088:"r",1089:"s",1090:"t",1091:"u",1092:"f",1093:"h",1094:"ts",1095:"ch",1096:"sh",1097:"sh",1099:"y",1101:"e",1102:"yu",1103:"ya",1105:"e",1098:"",1100:""},this.toLocalCase={f:"a",",":"b","<":"b",d:"v",u:"g",l:"d",t:"e",";":"zh",":":"zh",p:"z",b:"i",q:"y",r:"k",k:"l",v:"m",y:"n",j:"o",g:"p",h:"r",c:"s",n:"t",e:"u",a:"f","[":"h","{":"kh",w:"ts",x:"ch",i:"sh",o:"sh",s:"y","'":"e",'"':"e",".":"yu",">":"yu",z:"ya","`":"e","~":"e",m:"","]":"","}":""},this.toLocalTranslit={1072:"f",1074:"d",1075:"u",1076:"l",1077:"t",1079:"p",1080:"b",1081:"q",1082:"r",1083:"k",1084:"v",1085:"y",1086:"j",1087:"g",1088:"h",1089:"c",1090:"n",1091:"e",1092:"a",1094:"w",1095:"x",1096:"i",1097:"o",1099:"s",1103:"z",1098:"m"},this.list=e||[],this.iterCur=0,this.iterEnd=e?e.length:0,this.index={},this.callback=n||function(){},this.prepareFunc=t||function(e){return e},setTimeout(this.indexIteration.bind(this),10)}return e.prototype.indexIteration=function(){for(var e=Math.min(this.iterEnd,this.iterCur+200),t=this.iterCur;t<e;t++){var n=this.list[t];try{n._order=t}catch(e){}this.add(n)}this.iterCur=t,t>=this.iterEnd?this.callback(this):setTimeout(this.indexIteration.bind(this),10)},e.prototype.strToPrefixes=function(e){for(var t,n={},a=(t=e,t.replace(/&#(\d\d+);/g,(function(e,t){return(t=!0===(n=t)?1:parseInt(n)||0)>=32?String.fromCharCode(t):e;var n})).replace(/&quot;/gi,'"').replace(/&lt;/gi,"<").replace(/&gt;/gi,">").replace(/&amp;/gi,"&")).toLowerCase().split(this.delimiter),o=a.length;o--;){var r=a[o],i="";if(r){for(var s=0;s<6;s++){var l=r.charCodeAt(s);if(l){var c=this.toTranslit[l],u=r.substr(s,1);i+=null!=c?c:u}}n[i]=1}}return n},e.prototype.strToSearchPrefixes=function(e){for(var t=[],n=e.toLowerCase().split(this.delimiter),a=n.length;a--;){var o={},r=n[a],i="",s="",l="",c=r.length>1;if(r){for(var u=0;u<6;u++){var d=r.charCodeAt(u);if(d){var h=this.toTranslit[d],m=r.substr(u,1);if(i+=null!=h?h:m,c){var g=this.toLocalCase[m],v=this.toLocalTranslit[d];s+=null!=g?g:m,l+=null!=v?v:m}}}o[i]=1,c&&(o[s]=2,o[l]=3),t.push(o)}}return t},e.prototype.toIndexTree=function(e,t){for(var n=this.index,a=0;a<6;a++){var o=e.substr(a,1)||-1;n=n[o]?n[o]:n[o]=5==a?[]:{}}n.push(t)},e.prototype.remove=function(e){var t=this.prepareFunc(e),n=this.strToPrefixes(t);for(var a in n)if(n.hasOwnProperty(a)){for(var o=this.index,r=0;r<6;r++){var i=a.substr(r,1)||-1;if(!o[i])break;o=o[i]}if(o.length)for(var r in o)if(this.equals(o[r],e)){o.splice(r,1);break}}},e.prototype.equals=function(e,t){for(var n in e)if(e.hasOwnProperty(n))switch(typeof e[n]){case"object":if(!this.equals(e[n],t[n]))return!1;break;case"function":if(void 0===e[n]||e[n].toString()!=t[n].toString())return!1;break;default:if(e[n]!=t[n])return!1}for(var n in t)if(void 0===t[n])return!1;return!0},e.prototype.intersect=function(e,t){var n=[];if(o(e[0])||o(t[0]))return e.filter((function(e){return-1!==t.indexOf(e)}));for(;e.length>0&&t.length>0;)if(e[0]._order<t[0]._order)e.shift();else if(e[0]._order>t[0]._order)t.shift();else{if(this.equals(e[0],t[0])){var a=e.shift();a&&n.push(a)}t.shift()}return n},e.prototype.add=function(e){var t=this.prepareFunc(e),n=this.strToPrefixes(t);for(var a in n)n.hasOwnProperty(a)&&this.toIndexTree(a,e)},e.prototype.search=function(e){var t=this.index,n=this.strToSearchPrefixes(e),a=[],o=!1;for(var r in n)if(n.hasOwnProperty(r)){if(o&&!a)break;var i=this.localSearch(n[r],0,t);i.sort((function(e,t){return e._order-t._order})),a=o?this.intersect(a,i):i,o=!0}for(var s=a[0],l=a.length+1,c=[],u=1;u<l;u++){var d=a[u];d!=s&&(c.push(s),s=d)}return c},e.prototype.localSearch=function(e,t,n){if(!n)return[];var a={};for(var o in e)e.hasOwnProperty(o)&&(a[i=o.substr(t,1)||-1]||(a[i]={}),a[i][o]=1);if(6==t++)return n;var r=[];for(var i in a)if("-1"===i)for(var s in n)n.hasOwnProperty(s)&&r.push.apply(r,this.localSearch(a[i],t,n[s]));else{var l=this.localSearch(a[i],t,n[i]);r.push.apply(r,l)}return r},e}();function o(e){return!isNaN(e)}},125396:(e,t,n)=>{"use strict";n.d(t,{default:()=>g});var a=n(667294),o=n(887854),r=n.n(o),i=n(408091),s=n(634777),l=n(379333),c="0 0 24 24",u="settings_24",d=!1;function h(){d||((0,s.addSpriteSymbol)(new(r())({id:u,viewBox:c,content:'<symbol xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" id="settings_24"><g fill="none" fill-rule="evenodd"><path d="M0 0h24v24H0z" /><path d="M9.127 5.052c1.256-.72 1.473-1.469 1.623-2.219.167-.833.417-.833.833-.833h.834c.416 0 .583 0 .833.833.225.751.383 1.502 1.631 2.223 1.397.379 2.08.002 2.717-.422.707-.471.884-.294 1.178 0l.59.59c.294.294.412.412 0 1.178-.372.69-.791 1.333-.418 2.725.72 1.256 1.469 1.473 2.219 1.623.833.167.833.417.833.833v.834c0 .416 0 .583-.833.833-.751.225-1.502.383-2.223 1.631-.379 1.397-.002 2.08.422 2.717.471.707.294.884 0 1.178l-.59.59c-.294.294-.412.412-1.178 0-.69-.372-1.333-.791-2.725-.418-1.256.72-1.473 1.469-1.623 2.219-.167.833-.417.833-.833.833h-.834c-.416 0-.583 0-.833-.833-.225-.751-.383-1.502-1.631-2.223-1.397-.379-2.08-.002-2.717.422-.707.471-.884.294-1.178 0l-.59-.59c-.294-.294-.412-.412 0-1.178.372-.69.791-1.333.418-2.725-.72-1.256-1.469-1.473-2.219-1.623C2 13.083 2 12.833 2 12.417v-.834c0-.416 0-.583.833-.833.751-.225 1.502-.383 2.223-1.631.379-1.397.002-2.08-.422-2.717-.471-.707-.294-.884 0-1.178l.59-.59c.294-.294.412-.412 1.178 0 .69.372 1.333.791 2.725.418zM12 16.75a4.75 4.75 0 100-9.5 4.75 4.75 0 000 9.5z" fill="currentColor" /></g></symbol>'})),d=!0)}var m=function(e){return(0,s.useIsomorphicLayoutEffect)((function(){h()}),[]),a.createElement(l.SvgIcon,(0,i.assign)({},e,{viewBox:c,id:u,width:isNaN(e.width)?24:+e.width,height:isNaN(e.height)?24:+e.height}))};m.mountIcon=h;const g=m},147650:(e,t,n)=>{"use strict";n.d(t,{default:()=>g});var a=n(667294),o=n(887854),r=n.n(o),i=n(408091),s=n(634777),l=n(379333),c="0 0 24 24",u="smile_outline_24",d=!1;function h(){d||((0,s.addSpriteSymbol)(new(r())({id:u,viewBox:c,content:'<symbol fill="none" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" id="smile_outline_24"><path d="M8.438 14.297a.9.9 0 011.259.133c.013.016.196.223.53.432.383.24.97.488 1.773.488a3.3 3.3 0 001.773-.488c.191-.12.382-.26.53-.432a.9.9 0 011.4 1.132 4.045 4.045 0 01-.976.826A5.094 5.094 0 0112 17.15a5.094 5.094 0 01-2.727-.762 3.987 3.987 0 01-.976-.826.9.9 0 01.14-1.265zm1.812-4.047a1.25 1.25 0 11-2.5 0 1.25 1.25 0 012.5 0zM15 11.5A1.25 1.25 0 1015 9a1.25 1.25 0 000 2.5z" fill="currentColor" /><path fill-rule="evenodd" clip-rule="evenodd" d="M12 2.1c-5.468 0-9.9 4.432-9.9 9.9s4.432 9.9 9.9 9.9 9.9-4.432 9.9-9.9-4.432-9.9-9.9-9.9zM3.9 12a8.1 8.1 0 1116.2 0 8.1 8.1 0 01-16.2 0z" fill="currentColor" /></symbol>'})),d=!0)}var m=function(e){return(0,s.useIsomorphicLayoutEffect)((function(){h()}),[]),a.createElement(l.SvgIcon,(0,i.assign)({},e,{viewBox:c,id:u,width:isNaN(e.width)?24:+e.width,height:isNaN(e.height)?24:+e.height}))};m.mountIcon=h;const g=m},890470:(e,t,n)=>{"use strict";function a(){return{icon:'<svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="none" viewBox="0 0 20 20"><path fill="currentColor" d="M7.28 4.99l-.52 1.2c-.04.1-.06.14-.09.17a.28.28 0 01-.09.07.62.62 0 01-.17.04l-.75.1c-2.15.3-3.23.46-3.68.96a1.86 1.86 0 00-.44 1.61c.13.67.98 1.35 2.68 2.7l.27.23c.08.06.12.09.14.13a.28.28 0 01.04.11c.01.05 0 .1-.02.2l-.08.44c-.48 2.5-.71 3.75-.34 4.36a1.85 1.85 0 001.5.9c.72.02 1.7-.79 3.65-2.42l.34-.28c.1-.08.15-.12.2-.14a.28.28 0 01.16 0c.06.02.11.06.21.14l.34.28c1.95 1.63 2.93 2.44 3.65 2.41a1.85 1.85 0 001.5-.89c.37-.6.14-1.86-.34-4.36l-.08-.45c-.02-.1-.03-.14-.02-.19a.28.28 0 01.04-.11.62.62 0 01.14-.13l.27-.22c1.7-1.36 2.55-2.04 2.68-2.7a1.86 1.86 0 00-.44-1.62c-.45-.5-1.53-.65-3.68-.96l-.75-.1c-.09-.02-.13-.02-.17-.04a.28.28 0 01-.1-.07l-.08-.16-.52-1.21c-.86-2-1.3-2.99-1.9-3.29a1.85 1.85 0 00-1.66 0C8.57 2 8.14 3 7.28 5z"/></svg>',name:"favorite_20"}}n.d(t,{getIcon20Favorite:()=>a})},75874:(e,t,n)=>{"use strict";function a(){return{icon:'<svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="none" viewBox="0 0 20 20"><path fill="currentColor" fill-rule="evenodd" d="M10.4 3.13a.92.92 0 00-.82 0c-.05.03-.19.13-.44.6-.24.45-.52 1.09-.92 2-.16.38-.33.74-.48 1.12-.02.05-.09.2-.2.33a1.02 1.02 0 01-.33.25c-.16.08-.35.1-.38.1l-.68.1c-1 .14-1.69.24-2.19.35-.52.13-.66.23-.7.27a.92.92 0 00-.21.8c0 .05.07.22.46.59.37.35.92.8 1.7 1.42l.25.2a1.02 1.02 0 01.42 1.13l-.08.41a35.03 35.03 0 00-.43 2.56c-.07.64 0 .82.03.86a.92.92 0 00.74.44c.05 0 .24-.02.77-.39.49-.34 1.13-.87 2.03-1.62l.31-.26.15-.12c.07-.04.17-.11.32-.15a1.02 1.02 0 01.55 0c.15.04.25.1.32.15l.15.12.31.26c.9.75 1.54 1.28 2.03 1.62.53.37.72.4.77.4a.92.92 0 00.74-.45c.03-.04.1-.22.03-.86-.06-.6-.21-1.4-.43-2.56l-.08-.42a1.25 1.25 0 01-.02-.4 1.03 1.03 0 01.15-.42c.1-.17.26-.28.3-.3l.24-.2c.78-.63 1.33-1.07 1.7-1.42.39-.37.45-.54.46-.59a.92.92 0 00-.22-.8c-.03-.04-.17-.14-.7-.27-.5-.11-1.18-.21-2.18-.35l-.7-.1c-.04 0-.2-.03-.36-.1a1.02 1.02 0 01-.33-.25c-.12-.14-.19-.31-.2-.34l-.48-1.1c-.4-.92-.68-1.56-.92-2-.25-.48-.4-.58-.44-.6zM8.9 1.76a2.45 2.45 0 012.2 0c.5.25.82.73 1.1 1.24.28.51.58 1.22.96 2.09l.41.95.53.07c.94.14 1.7.24 2.28.38.56.13 1.11.32 1.49.74a2.46 2.46 0 01.58 2.12c-.11.55-.5 1-.9 1.4-.43.4-1.03.89-1.78 1.48l-.11.1.04.22c.21 1.1.38 1.99.45 2.66.06.64.07 1.3-.25 1.81a2.46 2.46 0 01-1.99 1.18c-.6.02-1.18-.3-1.7-.67-.56-.38-1.24-.95-2.1-1.67l-.11-.09-.11.09c-.87.72-1.55 1.29-2.1 1.67-.53.37-1.1.7-1.71.67a2.46 2.46 0 01-2-1.18c-.3-.51-.3-1.17-.24-1.81.07-.67.24-1.55.45-2.66l.04-.23-.11-.09c-.74-.6-1.35-1.07-1.77-1.48-.42-.4-.8-.85-.9-1.4a2.46 2.46 0 01.58-2.12c.37-.42.92-.61 1.48-.74.58-.14 1.34-.24 2.28-.38l.53-.07.4-.95c.39-.87.7-1.58.97-2.1.28-.5.6-.98 1.1-1.23z" clip-rule="evenodd"/></svg>',name:"favorite_outline_20"}}n.d(t,{getIcon20FavoriteOutline:()=>a})},161381:(e,t,n)=>{"use strict";function a(){return{icon:'<svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="none" viewBox="0 0 20 20"><path fill="currentColor" d="M12.6 2.22a.75.75 0 00-1.27.38l-.3 1.54a.3.3 0 01-.09.16L8.48 6.76a.3.3 0 01-.19.08l-3.86.3a1.01 1.01 0 00-.63 1.73l2.96 2.96-4.47 4.46a1 1 0 001.42 1.42l4.46-4.47 2.97 2.96c.61.62 1.65.22 1.72-.63l.3-3.86a.3.3 0 01.08-.19l2.47-2.46a.3.3 0 01.15-.08l1.54-.31c.58-.12.8-.84.38-1.27L12.6 2.22z"/></svg>',name:"pin_20"}}n.d(t,{getIcon20Pin:()=>a})},110757:(e,t,n)=>{"use strict";n.d(t,{MessageForward:()=>A});n(175115),n(530522),n(66108),n(991181),n(579665),n(95767),n(820075),n(940851),n(296253);var a=n(667294),o=(n(45697),n(268959)),r=n(439664),i=n(413374),s=n(454593),l=n(191040),c=n(597903),u=n(104837),d=n(459554),h=n(645523),m=n(41650),g=n(412947),v=n(483295),p=n(329164),f=n(863729),_=n(654612),C=n(923876),b=n(147650),I=n(254589);function E(){return E=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&(e[a]=n[a])}return e},E.apply(this,arguments)}function S(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(e)))return;var n=[],a=!0,o=!1,r=void 0;try{for(var i,s=e[Symbol.iterator]();!(a=(i=s.next()).done)&&(n.push(i.value),!t||n.length!==t);a=!0);}catch(e){o=!0,r=e}finally{try{a||null==s.return||s.return()}finally{if(o)throw r}}return n}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return w(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(n);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return w(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function w(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,a=new Array(t);n<t;n++)a[n]=e[n];return a}var y=(0,l.debouncedPromise)(s.searchHints,300),T=m.default.getLang;class k extends a.Component{constructor(e){var t;super(e),t=this,this.toggleMode=()=>{var e=this.props.store;if((0,u.isCommunityInterface)(e)){var t=0===this.state.mode?1:0,n=0===t?s.searchImTopConv:s.searchTopConv;this.setState({value:"",mode:t,loading:!0,selected:null,found:[]},(()=>n("",e.get()).then((e=>this.setSearchResults(this.filterResults(e)))).then((()=>this.searchInput.focus())).catch((e=>console.error(e)))))}},this.onChange=e=>{this.setState({value:e.target.value,loading:!0,error:null});var t=e.target.value;this.searchQuery!==t&&(this.searchQuery=t,this.onSearch(t))},this.filterResults=e=>{var t=(0,u.isCommunityInterface)(this.props.store)&&1===this.state.mode;return e.filter((e=>{var n=e.peerId;return!(t&&n<0)&&(!(t&&n>2e9&&!(0,d.doesChatTabHaveFlag)(e,1024))&&!(!t&&n>2e9&&(0,d.doesChatTabHaveFlag)(e,1024)))}))},this.onSearch=e=>{var t=this.props.store,n=t.get(),a=(0,u.isCommunityInterface)(t)&&0===this.state.mode,o=a?s.searchImTopConv:s.searchTopConv;return 1===this.state.mode&&""===e?this.emptySearch().then((e=>{this.setSearchResults(this.filterResults(e))})):o(e,n).then((t=>{var o=t.map((e=>e.peerId));return t=this.filterResults(t),this.setSearchResults(t,!1,!t.length),e?y(e,o,"all",{hidegid:a,skipStoreUpdate:a},n):Promise.resolve([])})).then((t=>{e===this.state.value&&this.setSearchResults(this.filterResults(t),!0)})).catch((()=>{}))},this.emptySearch=()=>{var e=this.props.store,t=e.get(),n=t.dialog_tabs.all,a={},o={};return(0,s.searchTopConv)("",t).then((r=>(r.forEach((e=>{o[e.peerId]=e})),[t.peer].concat(n.filter((e=>e!==t.peer))).map((t=>{var n=(0,u.getTab)(e,t);return a[t]=!0,{name:o[t]&&o[t].tab||n.tab,photo:o[t]&&o[t].photo||n.photo,lastmsg:n.lastmsg,major_sort_id:n.major_sort_id,minor_sort_id:n.minor_sort_id,data:n.data,peerId:t}})).concat(r.filter((e=>!a[e.peerId]))).sort(((n,a)=>n.peerId===t.peer?-1:a.peerId===t.peer?1:(0,C.sortFn)(e,n,a))))))},this.sendRecipient=e=>{var t=this.props.store,n=t.get();1===this.state.mode?(n.longpoll.push([(0,h.changePeer)(e,!1,!0,!0,"forward_messages_popup")]),(0,g.statlogsForwardEvent)(t),(0,u.isCommunityInterface)(t)&&(0,g.statlogsForwardFromCommunityEvent)(t,!1)):this.setState({selected:e,error:null},(()=>{Emoji.focus(this.input)}))},this.loadMore=()=>{},this.getSearchInputEl=e=>this.searchInput=e,this.setSearchResults=function(e,n){var a=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(!t.unmounted)if(n){var o=e.filter((e=>!t.found[e.peerId]));o.forEach((e=>{t.found[e.peerId]=!0})),t.setState({found:[].concat(t.state.found,o),loading:a})}else t.found=e.reduce(((e,t)=>(e[t.peerId]=!0,e)),{}),t.setState({found:e,loading:a,activeElement:0})},this.getFormRef=e=>{this.form=e},this.getInputRef=e=>{this.input=e},this.getEmojiButtonRef=e=>{this.emojiButton=e},this.onEmojiButtonMouseOver=e=>{e.persist(),Emoji.show(this.emojiButton,e)},this.onEmojiButtonMouseOut=e=>{e.persist(),Emoji.hide(this.emojiButton,e)},this.send=()=>{var e=this.props.store,t=this.state.selected,n=Emoji.val(this.input).trim(),a=new p.ImDraft({},0),o=e.get().pendingForward;if(t&&!(0,c.isMessageTooLong)(val)){this.setState({sending:!0});var r=(0,u.isCommunityInterface)(e)&&0===this.state.mode;r||a.addAttach("mail",o.msgIds.join(";"),o.object||null);var i={message:n,attaches:a.dData.attaches.map((e=>[e.type,e.id]))||[]},l={hidegid:!0,external:{original_gid:e.get().id,fwd_group_msg_ids:r?o.msgIds.join(";"):void 0}};new Promise((n=>{(0,s.loadHashes)([t],{hidegid:!0},e.get()).then((e=>{var a=S(e,1)[0];return n(a[t])}))})).then((n=>e.set(s.sendMessage.bind(null,t,i,E({hash:n},l))))).then((()=>{(0,g.statlogsForwardFromCommunityEvent)(e,!0),e.setState({pendingForward:null}),this.props.closePopup(),showDoneBox(T("mail_send3"))})).catch((e=>{this.unmounted||this.setState({sending:!1},(()=>{(0,_.showFastBox)(T("mail_error"),e)}))}))}},this.onSearchKeyDown=e=>{27===e.keyCode&&this.state.value&&(this.searchInput.blur(),this.searchQuery="",this.setState({value:"",loading:!0,error:null},this.onSearch.bind(this,"")),e.stopPropagation())},this.onMessageInputKeyDown=e=>{27===e.keyCode&&(this.state.sending||(Emoji.val(this.input,""),this.setState({selected:null}),this.searchInput.focus()),e.stopPropagation())},this.state={value:"",found:[],mode:1,loading:!0,sending:!1,selected:null,activeElement:0},this.emptySearch().then((e=>{this.setSearchResults(this.filterResults(e))})).catch((e=>console.error(e)))}componentDidMount(){this.props.updatePopup(),Emoji.init(this.input,{noStickers:!0,onSend:this.send}),this.input.addEventListener("keydown",this.onMessageInputKeyDown)}componentWillUnmount(){this.input.removeEventListener("keydown",this.onMessageInputKeyDown),this.unmounted=!0}render(){var e=this.props,t=e.store,n=e.closePopup,s=this.state,l=s.mode,c=s.loading,d=s.selected,h=s.found,m=s.sending,g=(0,v.classNames)("MessageForward",{"MessageForward--form":0===l&&!!d});return a.createElement("section",{className:g},a.createElement(o.default,{title:a.createElement(a.Fragment,null,a.createElement("span",{className:"MessageForward__title"},T("mail_forward_messages")),(0,u.isCommunityInterface)(t)&&a.createElement("span",{className:"MessageForward__switch",onClick:this.toggleMode},T(0===l?"mail_forward_to_community_messages":"mail_forward_to_im"))),onCloseClick:n}),a.createElement("div",{className:"MessageForward__content"},a.createElement(i.ConvoPicker,{searchValue:this.state.value,isLoading:c,convos:h.map((e=>e||(0,u.getTab)(t,e.peerId))),mode:1===l?i.convoPickerMode.DEFAULT:i.convoPickerMode.RADIO,selectedConvos:[d],onSearchValueChange:this.onChange,onSearchInputKeydown:this.onSearchKeyDown,onConvoSelect:this.sendRecipient,onListLoadMore:this.loadMore,searchInputGetter:this.getSearchInputEl,className:"MessageForward__convoPicker"}),a.createElement("footer",{className:"MessageForward__footer",ref:this.getFormRef,key:"footer"},a.createElement("div",{className:"MessageForward__form _emoji_field_wrap"},a.createElement("div",{className:"MessageForward__input",tabIndex:"0",contentEditable:!0,role:"textbox","aria-multiline":!0,ref:this.getInputRef,placeholder:T("mail_im_enter_msg")}),a.createElement("div",{className:"MessageForward__emoji emoji_smile_wrap _emoji_wrap"},a.createElement("div",{ref:this.getEmojiButtonRef,className:"emoji_smile _emoji_btn",title:T("global_emoji_hint"),onMouseOver:this.onEmojiButtonMouseOver,onMouseOut:this.onEmojiButtonMouseOut,onClick:this.onEmojiButtonClick},a.createElement(b.default,null)))),m?a.createElement("div",{className:"MessageForward__send-spinner"},a.createElement(r.default,null)):a.createElement("button",{className:"MessageForward__send",onClick:this.send},a.createElement(I.default,null)))))}}var A=(0,f.connect)(k)},31847:(e,t,n)=>{"use strict";n.d(t,{checkContactListLoaded:()=>U,mount:()=>ne});n(820075),n(991181),n(59357),n(940851),n(296253);var a=n(376852),o=n(786067),r=n(610124),i=n(454593),s=n(597903),l=n(663825),c=n(645523),u=n(104837),d=n(483295),h=n(294940),m=n(549892),g=n(778755),v=n(204477),p=n(983813),f=n(456286),_=n(19331),C=n(459554),b=n(993421),I=n(315544),E=n(695724),S=n(57757),w=n(124041),y=n(890470),T=n(75874),k=n(491372),A=n(161381),L="_im_dialog_action_wrapper",M="_im_dialog_call_action_wrapper",P="_im_header_icon",N="_im_page_action",R="_im_chat_verified",B="._im_page_status",F="im-page--chat-header_reconnected",O="im-page--header-action_loading";function x(e,t,n){return!e.map((e=>{var a=(0,u.getMessage)(t,n,e);return a&&(0,h.isImportant)(a)})).reduce(((e,t)=>e&&t),!0)}function D(e,t){var n=t.get(),a=n.peer,o=n.tabs[a].pinned;return 1===e.length&&o&&e[0]===(0,u.parserMessage)(o).messageId}function U(e){return e.get().contactsList?Promise.resolve(e):e.set(i.getContactsList)}function H(e,t,n){var a=(0,o.getLang)("mail_selected_shorted",t.length);z({actions:!0},"im-page--chat-header"),(0,I.val)((0,I.geByClass1)("im-page--selected-messages"),(0,E.getTemplate)("im_selected_messages",{label:a.replace("{count}",t.length),tip:(0,o.getLang)("mail_deselect_all")}));var r=(0,u.getTab)(n,n.get().peer),i=t.some((e=>{var t=(0,u.getMessage)(n,n.get().peer,e);if(!t)return!1;var a=t.attaches[0];return!(!a||"widget"!==a.type)})),l=e.querySelector("._im_mess_actions"),c=x(t,n,n.get().peer),h=D(t,n),m=t.length>1,g=!m&&(0,s.isChatPeer)(r.peerId)&&(0,s.canPinMessage)(n,t[0]),v=(0,s.canForwardMessages)(n,t)&&!i,p=e.querySelector('._im_page_action[data-action="pin"]'),f=e.querySelector('._im_page_action[data-action="star"]'),_=e.querySelector('._im_page_action[data-action="respond"]'),b=e.querySelector('._im_page_action[data-action="forward"]'),S=Boolean((0,u.tabIsOutgoingMessageRequest)(r)),L=Boolean((0,u.tabIsMessageRequest)(r)),M=(0,C.isBusinessNotifyPeer)(n,n.get().peer);l.className=(0,d.classNames)("im-page--mess-actions _im_mess_actions",{"im-page--mess-actions_important":!c&&!i,"im-page--mess-actions_pinned":h,"im-page--mess-actions_channel":(0,u.isChannelPeer)(r)&&!n.get().gid,"im-page--mess-actions_multiple-selection":m,"im-page--mess-actions_no-pin-btn":!g,"im-page--mess-actions_out-mr":S,"im-page--mess-actions_in-mr":L,"im-page--mess-actions_business-notify":M,"im-page--mess-actions_no-important-btn":!(0,s.canMarkImportant)(n,t)||i}),p.innerHTML=h?(0,A.getIcon20Pin)().icon:(0,k.getIcon20PinOutline)().icon,f.innerHTML=c||i?(0,T.getIcon20FavoriteOutline)().icon:(0,y.getIcon20Favorite)().icon,t.length>1?w.FlatButton.setLabel(_,(0,o.getLang)("mail_forward_here")):w.FlatButton.setLabel(_,(0,o.getLang)("mail_im_mark_reply")),v?w.FlatButton.setDisabled(b,!1):w.FlatButton.setDisabled(b,!0),m&&!v||(0,C.isBusinessNotifyTab)(r)||i?w.FlatButton.setDisabled(_,!0):w.FlatButton.setDisabled(_,!1);var P=c?(0,o.getLang)("mail_im_toggle_important"):(0,o.getLang)("mail_im_toggle_important_off"),N=h?(0,o.getLang)("mail_unpin"):(0,o.getLang)("mail_pin");attr((0,I.geByClass1)("im-page-action_star",e),"aria-label",P),attr((0,I.geByClass1)("im-page-action_pin",e),"aria-label",N)}function j(e,t,n){var a=t.get(),o=a.peer,r=a.tabs[o],l=(0,I.geByClass1)(R,e),c=(0,I.geByClass1)(s.PINNED_CONTAINER_CLASS,e),d=(0,s.isChatPeer)(o),h=d&&(0,u.isChannelPeer)(r),v=d&&(0,C.isBusinessNotifyTab)(r)&&(0,b.isBusinessNotifyEnabled)(t),p=a.selectedMessages&&!!a.selectedMessages.length;l.tt=!1;var f=(0,s.renderPhotosFromTab)(t,r,!1),_=(0,E.getTemplate)("im_simple_link",{href:h?"/club"+-r.ownerId:r.href,content:(0,E.getTemplate)("im_peer_photo",{online_class:"",owner_photo:f,modifier_class:"nim-peer_smaller"})});(0,I.val)((0,I.geByClass1)("im-page--aside-photo",e),_);var S=d&&(0,u.isChatActive)(r),w={muted:inArray(o,a.mutedPeers),verified:!!r.verified,chat:d,vkcomgroup:h,actions:p,derelict:d&&!S&&!h&&!v,pinned:!1};if(d){var y=(0,u.getPinnedMessage)(t),T=function(e){var t=(0,u.getPinnedMessage)(e);if(!t||(0,m.oCacheGet)(e,t.userId))return!1;return t.userId}(t);y&&(0,g.isPinnedMessageVisibleInTab)(t,o)&&(T?t.set(i.loadChatMember.bind(null,{[o]:[T]})).then(j.bind(null,e,t,n)):w.pinned=!0)}q(t,r,e);var k=!r.top_banner&&c.innerHTML,A=!r.top_banner&&G(t,e,c),L=(0,I.geByClass1)("_im_page_peer_name",e);(0,I.removeClass)(L,s.DESELECT_ALL_CLASS),function(e,t,n){var a=n.length>0;(0,I.geByClass)(P,e).forEach((e=>{if("star"===e.dataset.type&&(0,s.isFoldersAvailable)(t)&&((0,I.toggleClass)(e,"im-page--header-icon_shown",!a),(0,I.toggleClass)(e,"im-page--header-icon_star-active",(0,s.isImportant)(t))),"answer"===e.dataset.type&&(0,s.isFoldersAvailable)(t)&&(0,I.toggleClass)(e,"im-page--header-icon_shown",!a&&(0,s.isUnrespond)(t)),"search"===e.dataset.type&&!(0,s.isCommunityInterface)(t)){var n=t.get().peer,o=!a&&(0,s.isFullyLoadedTab)(t,n)&&(0,u.getTab)(t,n).offset&&!(0,s.isCommunityInterface)(t)&&(!(0,s.isCallToPeerAvailable)(t,n)||!(0,s.isClassicInterface)(t));(0,I.toggleClass)(e,"im-page--header-icon_shown",o)}}))}(e,t,[]);var M=e.querySelector("._im_dialog_call_action_wrapper"),N=e.querySelector("._im_header_icon[data-type=call]");if(M&&M.classList.toggle("im-page--header-call-is-hidden",!(0,s.isCallToPeerAvailable)(t,o)||!!r.callInProgress),N&&(N.classList.toggle("im-page--header-icon_shown",(0,s.isCallToPeerAvailable)(t,o)&&!!r.callInProgress),N.classList.toggle("im-page--header-icon_call-active",!!r.callInProgress&&r.callInProgress.participants.count>0)),(0,s.isClassicInterface)(t)){var B=(0,I.geByClass1)("_im_page_back",e);attr(B,"href",`${(0,s.getBaseLink)(t)}?tab=${a.active_tab}`)}z(w,"im-page--chat-header"),(0,s.compensateHistoryHeightChange)(t,A,k,n)}function q(e,t,n){var a=(0,s.isChatPeer)(t.peerId),r=a&&(0,u.isChannelPeer)(t),i=a&&(0,u.isChatActive)(t),l=a&&(0,u.isCasperChatTab)(t),c=a&&(0,C.isBusinessNotifyTab)(t)&&(0,b.isBusinessNotifyEnabled)(e),d=(0,s.isContactPeer)(t.peerId),h=t.isDonutChat,m="";a?m=r?(0,E.getTemplate)("im_vkcomgroup_members",{name:(0,o.getLang)("mail_im_n_vkcomgroup_members",(0,s.getAliveMembersCount)(t))}):i?(0,E.getTemplate)("im_chat_members",{name:(0,o.getLang)("mail_im_n_chat_members",(0,s.getAliveMembersCount)(t))}):"":(0,s.isUserPeer)(t.peerId)&&(m=(0,s.getLastSeenTextInHeader)(e,t.peerId));var g=[];""!==m||c||g.push("im-page--title--1line"),l&&g.push("im-page--title--casper"),h&&g.push("im-page--title--donut"),c&&g.push("im-page--title--business-notify"),g=g.join(" ");var v=d?(0,s.prepareContactName)(t.name):t.tab,p=(0,E.getTemplate)("im_simple_name",{name:v,href:r?"/club"+-t.ownerId:t.href,name_attr:stripHTML(v),ads_union:t.ad_union_ids_attr,online:m,more_cls:g,more_children:c?(0,E.getTemplate)("sImSimpleNameBusinessNotifyLabel",{text:(0,o.getLang)("mail_tab_business_notify")}):""});(0,I.val)((0,I.geByClass1)("im-page--title-wrapper",n),p)}function G(e,t,n){var a=(0,u.getPinnedMessage)(e),o=n||(0,I.geByClass1)(s.PINNED_CONTAINER_CLASS,t);if((0,I.removeClass)(o,"im-page--pinned_with-bar"),a&&(0,h.isMoneyRequest)(a)){if(void 0===a.kludges.attach1_tr_amount)return;a.kludges.attach1_total_amount&&(0,I.addClass)(o,"im-page--pinned_with-bar")}var r=(0,s.renderPinnedMessage)(e);return(0,I.val)(o,r),!!r}function z(e,t){var n=(0,I.geByClass1)(t);Object.keys(e).forEach((a=>{(0,I.toggleClass)(n,`${t}_${a}`,!!e[a])}))}function V(e,t,n,a,o){e.set(i.removeMessagesWithRestore.bind(null,n,o,a)).then(t().removeMessagesRestore.bind(null,n,o,a)),(0,i.removeMessageSend)(n,o,null,a,e.get()).then((()=>{var a=(0,u.getTab)(e,o);n.includes(a.lastmsg)&&(0,i.loadActualLastMessage)(e,o).then((()=>{(0,_.partConfigEnabled)("messenger_empty_pinned_support")&&t().updateConvoInList(o,e),t().updateState(o,e)}))}))}function K(e,t,n,a,o){var r=e.get().selectedMessages,c=domData(o,"action"),d=e.get().peer,h=(0,u.getTab)(e,d),m=!0;if(!["star","delete"].includes(c)&&(0,u.tabIsOutgoingMessageRequest)(h))return Y(e,t,n);switch(c){case"delete":var g=!(vk.id==d&&!e.get().gid)&&r.every((t=>(0,s.canMessageBeDeletedForAll)(e,(0,u.getMessage)(e,d,t))));if(g||r.length>1){m=!1;var v=(0,s.showMsgDeleteDialog)(d,r.length,g,(a=>{Y(e,t,n),v.hide(),cur.imDb.updateByKey("del_forall_checked",a),a?(0,i.removeMessageSend)(r,d,null,"deleteforall",e.get()):V(e,t,r,c,d)}))}else V(e,t,r,c,d);break;case"spam":V(e,t,r,c,d);break;case"forward":if(!(0,s.canForwardMessages)(e,r))return;(0,i.processFwd)(r,d,e).then((t=>e.set(i.prepareForward.bind(null,t)))).then((()=>n().showForward(e))).catch((e=>console.error(e)));break;case"star":var p=x(r,e,d);e.set(i.favMessage.bind(null,r,p,d)),e.get().longpoll.push(r.map((e=>({type:p?l.SET_FLAGS:l.RESET_FLAGS,messageId:e,peerId:d,flags:l.FLAG_IMPORTANT}))));break;case"respond":var f=e.get(),_=1===r.length;(0,i.processFwd)(r,f.peer,e).then((t=>e.set(i.forwardMessages.bind(null,t,f.tfdraft,_)))).then((()=>{t().respond(e,d)}));break;case"pin":var C=(0,u.getLocalId)(e,r[0]);if(!(0,s.canPinMessage)(e,C))return;var b=D(r,e),I=b?i.unpinMessageOptimistic.bind(null,d):i.pinMessageOptimistic.bind(null,C,d),E=b?i.unpinMessage.bind(null,d):i.pinMessage.bind(null,C,d),S=ee.bind(null,t,d);e.set(i.checkChatMember.bind(null,e,C,d)).then((e=>e.set(I))).then(S).then((e=>e.set(E))).then(S)}m&&Y(e,t,n)}function W(e,t,n,a,o,r){var i=domData(r,"action"),s=a.querySelector(`.${L} ._ui_menu`).parentNode,l=e.get().peer;(0,S.handleUiActionForPeer)(e,t,n,i,l),uiActionsMenu.toggle(s,!1),t().cancelEditing()}function Y(e,t,n){var a=e.get().selectedMessages;e.set(i.cleanSelected).then(n().changedMessageSelection).then(t().cleanSelection.bind(null,a))}function $(e,t,n,r){var i,l,c=(0,s.isClassicInterface)(e);switch(domData(r,"type")){case"star":l=[4,6],i=()=>(0,s.isImportant)(e)?(0,o.getLang)("mail_im_toggle_important_off"):(0,o.getLang)("mail_im_toggle_important");break;case"answer":l=[4,6],i=(0,o.getLang)("mail_end_conversation");break;case"search":l=c?[5,6]:[4,-9],i=(0,o.getLang)("mail_search_in_peer")}(0,a.showTooltip)(r,{text:i||"",black:1,shift:l,forcetoup:!0,appendParentCls:c?"_im_dialog_actions":"_im_mess_actions"})}function Q(e,t,n){var o=(0,s.isClassicInterface)(e),r=domData(n.target,"action");"respond"!==r&&"forward"!==r&&(0,a.showTooltip)(n.target,{text:J.bind(null,e,r)||"",black:1,shift:[2,o?-4:11],forcetodown:!0,appendParentCls:"_im_dialog_actions"})}function J(e,t){var n=e.get(),a=n.selectedMessages,r=n.peer;switch(t){case"pin":return D(a,e)?(0,o.getLang)("mail_unpin"):(0,o.getLang)("mail_pin");case"star":return x(a,e,r)?(0,o.getLang)("mail_im_toggle_important"):(0,o.getLang)("mail_im_toggle_important_off");case"delete":return(0,o.getLang)("mail_delete");case"spam":return(0,o.getLang)("mail_im_mark_spam")}}function X(e,t,n,a,r){var l=domData(r,"type"),d=e.get().peer;switch(l){case"star":e.set(i.toggleDialogImportant.bind(null,d)).then((()=>{setTimeout((()=>$(e,0,0,r)),40)}));break;case"search":n().showSearch(e),window.tooltips&&tooltips.hide(r,{fasthide:!0});break;case"answer":(0,u.getTab)(e,d)&&(e.set(i.markDialogAnswered.bind(null,e.get().peer)),showDoneBox((0,o.getLang)("mail_marked_as_answered"),{out:1e3}),e.get().longpoll.push([(0,c.resetPeer)()]));break;case"call":if((0,s.isCallToPeerAvailable)(e,d)){var h=(0,u.getTab)(e,d).callInProgress;h&&(0,s.joinCallFromIm)(e,d,h.join_link,!1,s.CALL_ENTRY_POINT_JOIN_HEADER)}}}function Z(e,t){var n=Number(t),a=(0,s.formatTimespan)(n,!0),r=(0,o.getLang)("mail_network_waiting").replace(/{timer}/gi,a);e.querySelector(B).innerHTML=r}function ee(e,t,n){return e().updateChatTopic(t,n),n}function te(e,t,n,a){var l={};return{changeActions(t){var n=e.querySelector(`.${L} ._ui_menu`),a=e.querySelector(`.${L}`),o=t.get().curActions||{},r=Object.keys(o).sort(((e,t)=>i.ACTION_PRIORITIES[e]-i.ACTION_PRIORITIES[t]));if(0!==r.length){for(var s=(0,E.getTemplate)("sUiActionsMenuSeparator"),l="",c=0,u=0;u<r.length;u++){var d=r[u];u>0&&(c/10|0)!=(i.ACTION_PRIORITIES[d]/10|0)&&(l+=s),l+=(0,E.getTemplate)("sImUiActionMenuItem",{action:d,name:o[d].name,icon:o[d].icon,classes:"_im_action"}),c=i.ACTION_PRIORITIES[d]}n.innerHTML=l,a.classList.remove(O)}else a.classList.add(O)},setNetworkWaitingStatus(t,n){l.interval&&clearInterval(l.interval);var a=(0,u.getTab)(n,(0,C.getCurrentTab)(n));a&&!(0,C.isBusinessNotifyTab)(a)&&(Z(e,t),l.timeout=t,l.interval=setInterval((()=>{l.timeout>1?(l.timeout--,Z(e,l.timeout)):(clearInterval(l.interval),l={})}),1e3))},setNetworkReconnectingStatus(t){l.interval&&clearInterval(l.interval),l={};var n,a,r=(0,u.getTab)(t,(0,C.getCurrentTab)(t));r&&!(0,C.isBusinessNotifyTab)(r)&&(n=e.querySelector(B),a=(0,o.getLang)("mail_network_reconnecting"),n&&(n.innerHTML=a))},clearNetworkStatus(){l.interval&&clearInterval(l.interval),l={},e.querySelector(B).innerHTML=""},showSettings(t){var n=t.get(),o=(0,u.getTab)(t,n.peer);(0,u.isChatActive)(o)&&(0,v.mount)(e,t,a)},showForward(t){(0,p.mount)(e,t,a)},renderPeer(n){j(e,n,t)},reRenderPinned(t){var n=(0,C.getCurrentTab)(t);n&&n.pinned&&G(t,e)},reRenderTitle(t){var n=(0,C.getCurrentTab)(t);n&&q(t,n,e)},renderActions(t){var n=t.get().selectedMessages||[];n.length>0&&H(e,n,t)},hideActions(t){if(!(0,s.isFullyLoadedTab)(t,t.get().peer)){(0,I.geByClass)(P,e).forEach((e=>{(0,I.addClass)(e,O)}));var n=(0,I.geByClass1)(L,e);(0,I.addClass)(n,O);var a=(0,I.geByClass1)(M,e);(0,I.addClass)(a,O)}},showActions(t){if((0,s.isFullyLoadedTab)(t,t.get().peer)){(0,I.geByClass)(P,e).forEach((e=>{(0,I.removeClass)(e,O)}));var n=(0,I.geByClass1)(L,e);(0,I.removeClass)(n,O);var a=(0,I.geByClass1)(M,e);(0,I.removeClass)(a,O)}},changedMessageSelection(n){if(0!==n.get().peer){var a=n.get().selectedMessages||[];a.length>0?H(e,a,n):j(e,n,t)}},updateLastSeen(t){!function(e,t){var n=e.get().peer,a=(0,I.geByClass1)("_im_page_peer_online",t);a&&(0,s.isUserPeer)(n)&&(0,u.getTab)(e,n)&&(0,s.applyInnerHtml)(a,(0,s.getLastSeenTextInHeader)(e,n))}(t,e)},deselectAll(e){Y(e,t,a)},updateState(e){t().updateState.bind(null,e)},unmount(){(0,r.destroyModule)(n),cancelStackFilter("fowrward")}}}function ne(e,t,n){var a=(0,r.createMutations)(te),o=a.callMutations,l=a.bindMutations,d=K.bind(null,t,n,o),h=W.bind(null,t,n,o,e),m=Y.bind(null,t,n,o),g=(e,n)=>{var a=t.get().peer,o=(0,u.getTab)(t,a);(0,s.showVerifiedTooltip)(n,(0,C.isBusinessNotifyTab)(o)?o.ownerId:a)},v=$.bind(null,t,e),p=Q.bind(null,t,e),_=X.bind(null,t,e,n),b=()=>o().showSettings(t),I=n=>{var a=t.get().peer;(0,s.isContactPeer)(a)&&((0,f.mount)(t,a,e),cancelEvent(n)),!gpeByClass("im-page--chat-header_chat",n.target,e)||gpeByClass("im-page--chat-header_vkcomgroup",n.target,e)||checkEvent(n)||(b(),cancelEvent(n))},E=()=>function(e,t){var n=()=>{t&&(t.classList.remove(F),t.removeEventListener("mouseleave",n))};t&&(t.classList.add(F),t.addEventListener("mouseleave",n)),e.get().longpoll.abortWaiting()}(t,e),S=(0,r.createModule)({handlers:(n,a)=>{a(e,"click",N,d),a(e,"click","_im_action",h),a(e,"click",s.DESELECT_ALL_CLASS,m),a(e,"mouseover",R,g),a(e,"mouseover",P,v),a(e,"mouseover",N,p),a(e,"click",P,_),a(e,"click","_im_header_link",I),a(e,"click","_im_page_peer_name",I),a(e,"click","_im_chat_members",b),a(e,"click","_im_page_reconnect",E),a(e,"click","_im_page_back",(e=>{checkEvent(e)||(t.get().longpoll.push([(0,c.resetPeer)()]),cancelEvent(e))}))}});return(0,s.isReservedPeer)(t.get().peer)||setTimeout((()=>{t.set(i.setActions).then(o().changeActions)})),l(e,n,S,o)}},456286:(e,t,n)=>{"use strict";n.d(t,{mount:()=>d});n(940851),n(296253);var a=n(667294),o=n(610124),r=n(973935),i=n(336022),s=n(31847);function l(e,t,n){var o=c();if(o){var l=t-19e8;r.render(a.createElement(i.ContactPopup,{store:e,onClose:n.closeContactPopup,getContactInfo:()=>function(e,t){return(0,s.checkContactListLoaded)(e).then((e=>{var n=function(e,t){var n=e.get().contactsList;return n?n.find((e=>e.id===t)):null}(e,t);return Promise.resolve(n)}))}(e,l)}),o)}}function c(){return document.querySelector("._im_contact_popup_container")}function u(e,t){return{unmount:()=>function(e,t){var n=c();n&&r.unmountComponentAtNode(n),(0,o.destroyModule)(e)}(e),closeContactPopup(){var e=c();r.unmountComponentAtNode(e)}}}function d(e,t,n,a){var r=(0,(0,o.createMutations)(u).bindMutations)((0,o.createModule)({handlers:(e,t)=>{}}),e);return l(e,t,r),r}},983813:(e,t,n)=>{"use strict";n.d(t,{mount:()=>v});n(940851),n(296253);var a,o=n(610124),r=n(667294),i=n(973935),s=n(863729),l=n(110757),c=n(454593),u=n(654612);function d(){a&&a.hide()}function h(){a&&a.updateBoxCoords()}function m(){return document.querySelector("#MessageForward")}function g(e){var t=document.querySelector("#box_layer_wrap"),n=document.querySelector("#box_loader"),a=isVisible(t);return{unmount(){var t=m();t&&i.unmountComponentAtNode(t),(0,o.destroyModule)(e)},showLoader(){boxRefreshCoords(n),show(n),a||show(t)},hideLoader(){hide(n),a||hide(t)}}}function v(e,t,n){var v=(0,(0,o.createMutations)(g).bindMutations)((0,o.createModule)({handlers:(e,t)=>{}})),p={hideButtons:!0,bodyStyle:"padding: 0; background: none;",width:500,onShow(){!function(e){var t=m();t&&i.render(r.createElement(s.default,{value:e},r.createElement(l.MessageForward,{closePopup:d,updatePopup:h})),t)}(t),requestAnimationFrame((()=>a.updateBoxCoords()))},onHideAttempt:()=>(t.set(c.prepareForward.bind(null,null)),v.unmount(),!0)};return v.showLoader(),Promise.resolve().then((e=>{v.hideLoader(),a=new u.MessageBox(p).content('<div id="MessageForward"></div>').show()})),v}},957680:(e,t,n)=>{"use strict";n.d(t,{ChatCreation:()=>S});var a,o=n(570655),r=n(667294),i=n(41650),s=n(792110),l=n(790422),c=n(903739),u=n(385211),d=n(623481),h=n(150382),m=n(288420),g=n(476288),v=n(179203),p=n(712439),f=n(191040),_=n(917791),C=n(826542),b=n(31847),I=n(923876),E=n(827749);!function(e){e[e.LOADING=0]="LOADING",e[e.LIST=1]="LIST",e[e.SETTINGS=2]="SETTINGS",e[e.PHOTO=3]="PHOTO",e[e.ERROR=4]="ERROR"}(a||(a={}));var S=function(e){var t=e.store,n=e.uploadAvatar,S=e.onClose,w=e.onBack,y=e.onCreateChat,T=e.onGoToConvo,k=e.preselectedUsers,A=(0,o.__read)((0,r.useState)([]),2),L=A[0],M=A[1],P=(0,o.__read)((0,r.useState)(a.LOADING),2),N=P[0],R=P[1],B=(0,o.__read)((0,r.useState)(0),2),F=B[0],O=B[1],x=(0,o.__read)((0,r.useState)(""),2),D=x[0],U=x[1],H=(0,o.__read)((0,r.useState)(""),2),j=H[0],q=H[1],G=(0,o.__read)((0,r.useState)(void 0),2),z=G[0],V=G[1],K=(0,o.__read)((0,r.useState)(k?new Map(k.map((function(e){return[e.id,(0,u.getTokenFromUserItem)(e)]}))):new Map),2),W=K[0],Y=K[1];(0,r.useEffect)((function(){(function(e){return(0,p.unpackStore)(e).hintsTree.then((function(t){var n=t.list.map((function(e){var t=(0,o.__read)(e,3),n=t[0];return{id:+n,peerId:+n,name:t[1],photo:t[2]}}));return function(e,t){return(0,b.checkContactListLoaded)(e).then((function(e){var n=e.get().contactsList.filter((function(e){return!e.user})).sort((function(e,t){return e.id<t.id?1:-1})).map((function(e){return{id:(0,I.getContactPeerId)(e.id),peerId:(0,I.getContactPeerId)(e.id),name:e.name,photo:e.photo||""}})),a=n.splice(0,n.length<3?n.length:3);return(0,o.__spreadArray)((0,o.__spreadArray)((0,o.__spreadArray)((0,o.__spreadArray)([],(0,o.__read)(t.slice(0,4))),(0,o.__read)(a)),(0,o.__read)(t.slice(4))),(0,o.__read)(n))}))}(e,n)}))})(t).then((function(e){if(k){var t=k.reduce((function(e,t){return e[t.peerId]=!0,e}),{}),n=k.concat(e.filter((function(e){return!t[e.peerId]})));M(n)}else M(e)})).then((function(){return R(a.LIST)})).catch((function(){R(a.ERROR)}))}),[]);var $=(0,f.debouncedPromise)(_.searchHints,300);switch(N){case a.SETTINGS:return r.createElement(l.ChatCreationModal,{title:(0,i.getLang)("mail_chat_creation_settings"),onClose:S,onBack:function(){return R(a.LIST)}},r.createElement(c.ChatSettingsContainer,{flags:F,setFlags:O,onClose:function(){return R(a.LIST)}}));case a.LIST:return r.createElement(l.ChatCreationModal,{title:(0,i.getLang)("mail_im_create_chat"),onBack:w,onClose:S},r.createElement(u.UsersListContainer,{usersList:L,selectedMap:W,setSelectedMap:Y,onServerSearch:function(e,n){return $(e,n,C.HintsSearchType.FRIENDS_AND_CONTACTS,{},t.get())}}),r.createElement(d.ConvoInfoContainer,{title:D,photo:j,selectedUserIds:Array.from(W.keys()),onTitleChange:U,onShowSettings:function(){return R(a.SETTINGS)},onCreateChat:function(){var e=Array.from(W.keys()),n=z||void 0;return t.set((function(t){return(0,v.createChatAction)(t,n,e,D,F)})).then((function(e){var t=e.get().next_peer;y(t),(0,E.collectChatCreateStats)(t,"create_chat__create_new")}))},onUploadAvatar:function(){R(a.PHOTO),n().then((function(e){if(e.photo&&e.photoData){var t=e.photo,n=e.photoData;q(t),V(n)}else V(void 0);R(a.LIST)})).catch((function(){R(a.ERROR)}))},onRemoveAvatar:function(){q(""),V(void 0)},onGoToConvo:T}));case a.ERROR:return r.createElement(l.ChatCreationModal,{title:(0,i.getLang)("global_error"),onClose:S},r.createElement(g.ModalBody,null,r.createElement("p",null,(0,i.getLang)("global_error"))),r.createElement(h.ModalFooter,{actionButtons:r.createElement(m.default,{onClick:S},(0,i.getLang)("global_close"))}));case a.LOADING:return r.createElement(s.default,null);case a.PHOTO:return r.createElement(r.Fragment,null)}}},523928:(e,t,n)=>{"use strict";n.d(t,{ChatCreationInfo:()=>u});var a=n(667294),o=n(25432),r=n(897404),i=n(889366),s=n(118690),l=n(41650),c=n(125396),u=function(e){var t=e.onChangeTitle,n=e.onResetTitle,u=e.onShowSettings,d=e.onButtonClickHandler,h=e.title,m=e.photo,g=e.loading,v=e.onUploadAvatar,p=e.onRemoveAvatar,f=e.isButtonDisabled,_=e.buttonText;return a.createElement("div",{className:"ChatCreationInfo"},a.createElement("div",{className:"ChatCreationInfo__avatarWrapper"},a.createElement(o.default,{photo:m,title:h,className:"ChatCreationInfo__avatar",onClick:v}),m&&a.createElement(r.default,{text:(0,l.getLang)("mail_settings_remove_photo"),position:"t",align:"left"},a.createElement("button",{onClick:p,className:"ChatCreationInfo__avatarRemove"}))),a.createElement(i.default,{className:"ChatCreationInfo__titleInput",isControlledOutside:!0,value:h,onChange:function(e){return t(e.target.value)},onCancel:n,placeholder:(0,l.getLang)("mail_im_chat_title_intro")}),a.createElement(r.default,{text:(0,l.getLang)("mail_chat_creation_settings_icon_tooltip"),position:"t"},a.createElement("button",{className:"ChatCreationInfo__settings",onClick:u,"aria-label":(0,l.getLang)("mail_chat_creation_settings_icon_tooltip")},a.createElement(c.default,null))),a.createElement(s.default,{disabled:f,loading:g,onClick:d},_))}},790422:(e,t,n)=>{"use strict";n.d(t,{ChatCreationModal:()=>s});var a=n(730365),o=n(743927),r=n(667294),i=n(41650),s=function(e){var t=e.children,n=e.title,s=e.onClose,l=e.onBack;return r.createElement(a.default,{onClose:s,disableBodyScroll:!0,className:"ChatCreationModal"},r.createElement(o.ModalHeader,{title:n,onClose:s,backText:l?(0,i.getLang)("global_back"):void 0,onBack:l}),r.createElement("div",{className:"ChatCreationModal__content"},t))}},270800:(e,t,n)=>{"use strict";n.d(t,{ChatCreationUserRow:()=>c});var a=n(919316),o=n(787255),r=n(814210),i=n(667294),s=n(597903),l=n(406042),c=function(e){var t=e.data,n=e.onSelect,c=e.isSelected,u=t.photo?t.photo:i.createElement(l.ConversationNoPhoto,{id:t.peerId,text:(0,s.getUserInitials)(t.name),size:"34",specificType:7});return i.createElement(o.default,{"data-id":t.peerId,onClick:function(){return n(t.peerId)},selectable:!0,aside:i.createElement(r.ListMultiSelectControl,{isSelected:c})},i.createElement(a.default,{"data-id":t.peerId,size:"34",title:t.name,photo:u}))}},182747:(e,t,n)=>{"use strict";n.d(t,{ChatCreationUserList:()=>i});var a=n(667294),o=n(470720),r=n(41650),i=function(e){var t=e.usersList,n=e.onRemoveToken,i=e.onChange,s=e.onSelect,l=e.renderSuggest,c=e.tokens,u=e.query;return a.createElement(o.default,{className:"ChatCreationUserList",tokens:c,removeTokenPlaceholder:(0,r.getLang)("mail_create_chat_remove_user"),onRemoveToken:n,placeholder:(0,r.getLang)("mail_search_creation"),value:u,onChange:i,onSelect:s,useInfiniteScroll:!0,hasMore:!1,virtualized:!0,loadMore:function(){},notFoundText:(0,r.getLang)("mail_no_users_found"),autoFocus:!0,isSearching:!1,renderSuggest:l,data:t})}},903739:(e,t,n)=>{"use strict";n.d(t,{ChatSettingsContainer:()=>r});var a=n(667294),o=n(367033),r=function(e){var t=e.setFlags,n=e.flags,r=e.onClose;return a.createElement(o.ChatSettingsOptions,{flags:n,back:r,isChatCreation:!0,onSave:function(e){return t(e),Promise.resolve()},afterSave:r,onCancel:r})}},623481:(e,t,n)=>{"use strict";n.d(t,{ConvoInfoContainer:()=>s});var a=n(570655),o=n(523928),r=n(667294),i=n(41650),s=function(e){var t=e.title,n=e.photo,s=e.selectedUserIds,c=e.onShowSettings,u=e.onTitleChange,d=e.onCreateChat,h=e.onUploadAvatar,m=e.onRemoveAvatar,g=e.onGoToConvo,v=(0,a.__read)((0,r.useState)(!1),2),p=v[0],f=v[1],_=(0,a.__read)((0,r.useState)(!l(t)),2),C=_[0],b=_[1],I=1===s.length&&!C&&!n,E=0!==s.length||C,S=(0,r.useCallback)((function(e){b(!l(e)),u(e)}),[]),w=!I&&!E,y=I?(0,i.getLang)("mail_im_go_to_dialog"):(0,i.getLang)("mail_im_create_chat");return r.createElement(o.ChatCreationInfo,{title:t,onResetTitle:function(){return S("")},onChangeTitle:S,photo:n,onShowSettings:c,onButtonClickHandler:function(){if(!p)if(f(!0),I){var e=(0,a.__read)(s,1)[0];g(+e)}else d().catch((function(){f(!1)}))},loading:p,isButtonDisabled:w,onUploadAvatar:h,onRemoveAvatar:m,buttonText:y})};function l(e){return!e.trim().replace("\n","")}},385211:(e,t,n)=>{"use strict";n.d(t,{UsersListContainer:()=>c,getTokenFromUserItem:()=>d});var a=n(570655),o=n(667294),r=n(182747),i=n(270800),s=n(203524),l=n(495283),c=function(e){var t=e.usersList,n=e.selectedMap,l=e.setSelectedMap,c=e.onServerSearch,h=(0,a.__read)((0,o.useState)(""),2),m=h[0],g=h[1],v=(0,a.__read)((0,o.useState)(t.map((function(e){return e.peerId}))),2),p=v[0],f=v[1],_=(0,o.useRef)(u(t)),C=(0,o.useCallback)((function(e){return e.name}),[]),b=(0,o.useCallback)((function(e){return e.peerId}),[]),I=(0,s.useIndexer)(Array.from(_.current.values()),C,b),E=(0,o.useMemo)((function(){return Array.from(_.current.keys())}),[_.current]),S=(0,o.useCallback)((function(e,t){return c(e,t)}),[c]);(0,o.useEffect)((function(){var e=I.search(m).map((function(e){return e.peerId}));f(e),S(m,e).then((function(t){if(0!==m.length){var n=[],o=[];t.forEach((function(e){_.current.has(e.peerId)||(o.push(e.peerId),n.push(function(e){return{id:e.peerId,peerId:e.peerId,name:e.name,photo:e.photo}}(e)))})),n.length&&(r=_,i=u(n),r.current=new Map((0,a.__spreadArray)((0,a.__spreadArray)([],(0,a.__read)(Array.from(r.current.entries()))),(0,a.__read)(Array.from(i.entries())))),f((0,a.__spreadArray)((0,a.__spreadArray)([],(0,a.__read)(e)),(0,a.__read)(o))))}var r,i})).catch((function(){}))}),[m]);var w=function(e){n.delete(e),l((function(){return new Map(n)}))},y=function(e){n.has(e)?w(e):(!function(e){var t=_.current.get(e);t&&(n.set(e,d(t)),l((function(){return new Map(n)})))}(e),g(""))},T=(0,o.useCallback)((function(e){w(+e)}),[n]),k=(0,o.useCallback)((function(e){g(e.target.value)}),[m]),A=Array.from(n.values());return o.createElement(r.ChatCreationUserList,{query:m,tokens:A,usersList:m?p:E,onSelect:y,onChange:k,onRemoveToken:T,renderSuggest:function(e){var t=_.current.get(e);return t?o.createElement(i.ChatCreationUserRow,{key:e,data:t,onSelect:y,isSelected:n.has(e)}):o.createElement(o.Fragment,null)}})};function u(e){return e.reduce((function(e,t){return t.name=(0,l.decodeHTMLEntities)(t.name),e.set(t.id,t)}),new Map)}function d(e){return{id:e.id.toString(),text:e.name}}},336022:(e,t,n)=>{"use strict";n.d(t,{ContactPopup:()=>d});var a=n(570655),o=n(667294),r=n(730365),i=n(161650),s=n(80291),l=n(792110),c=n(41650),u=n(982452),d=function(e){var t=e.getContactInfo,n=e.onClose,d=(0,a.__read)((0,o.useState)({kind:"loading"}),2),h=d[0],m=d[1];switch((0,o.useEffect)((function(){var e=function(e){(0,u.showErrorBox)(e),m({kind:"failed"}),n()};t().then((function(t){t?m({kind:"loaded",contact:t}):e((0,c.getLang)("mail_contact_was_removed"))})).catch((function(){e((0,c.getLang)("global_error"))}))}),[]),h.kind){case"failed":return o.createElement(o.Fragment,null);case"loading":return o.createElement(l.default,null);case"loaded":return o.createElement(r.default,{onClose:n,className:"ContactPopup"},o.createElement(i.default.Header,{title:(0,c.getLang)("mail_contact"),onClose:n}),o.createElement(s.ContactPopupContent,{contact:h.contact}))}}},387765:(e,t,n)=>{"use strict";n.d(t,{ContactIconRow:()=>r});var a=n(667294),o=n(483295),r=function(e){var t=e.icon,n=e.children,r=(0,o.classNames)("ContactIconRow__icon","ContactIconRow__icon--"+t);return a.createElement("div",{className:"ContactIconRow"},a.createElement("div",{className:r}),a.createElement("div",{className:"ContactIconRow__text"},n))}},80291:(e,t,n)=>{"use strict";n.d(t,{ContactPopupContent:()=>u});var a=n(667294),o=n(597903),r=n(387765),i=n(406042),s=n(213984),l=n(41650),c=n(923876),u=function(e){var t=e.contact,n=(0,c.getContactPeerId)(t.id);return a.createElement("div",{className:"ContactPopupContent"},a.createElement("header",{className:"ContactPopupContent__header"},a.createElement("div",{className:"ContactPopupContent__photo"},t.photo?a.createElement("img",{className:"ContactPopupContent__contactAvatarImage",src:t.photo,alt:t.name}):a.createElement(i.ConversationNoPhoto,{text:(0,o.getUserInitials)(t.name),size:"80",id:n,specificType:7,key:t.id})),a.createElement("h3",{className:"ContactPopupContent__title"},a.createElement(s.default,null,(0,o.prepareContactName)(t.name))),a.createElement("div",{className:"ContactPopupContent__meta"},(0,l.getLang)("mail_from_contacts_list"))),a.createElement("div",{className:"ContactPopupContent__info"},t.main_phone&&a.createElement(r.ContactIconRow,{icon:"phone"},(0,o.formatPhoneNumber)(t.main_phone)),t.emails[0]&&a.createElement(r.ContactIconRow,{icon:"mail"},a.createElement("a",{href:"mailto:"+t.emails[0]},t.emails[0]))),t.sync_date&&a.createElement("div",{className:"ContactPopupContent__info"},a.createElement(r.ContactIconRow,{icon:"sync"},t.sync_date)))}},413374:(e,t,n)=>{"use strict";n.d(t,{convoPickerMode:()=>a,ConvoPicker:()=>b});var a,o=n(570655),r=n(667294),i=n(973935),s=n(483295),l=n(878517),c=n(841118),u=n(439664),d=n(423985),h=n(254692),m=n(41650),g=n(61580),v=n(104837),p=n(597903),f=n(787255),_=n(239132),C=m.default.getLang;!function(e){e.DEFAULT="default",e.RADIO="radio"}(a||(a={}));var b=function(e){var t,n=e.searchValue,m=void 0===n?"":n,b=e.isLoading,I=void 0!==b&&b,E=e.convos,S=e.mode,w=void 0===S?a.DEFAULT:S,y=e.selectedConvos,T=void 0===y?[]:y,k=e.checkDisabled,A=e.onSearchValueChange,L=e.onSearchInputKeydown,M=e.onConvoSelect,P=e.onListLoadMore,N=void 0===P?function(){}:P,R=e.onAddClick,B=e.searchInputGetter,F=e.className,O=e.style,x=(0,o.__rest)(e,["searchValue","isLoading","convos","mode","selectedConvos","checkDisabled","onSearchValueChange","onSearchInputKeydown","onConvoSelect","onListLoadMore","onAddClick","searchInputGetter","className","style"]),D=(0,s.classNames)("ConvoPicker",F),U=(0,r.createRef)(),H=(0,o.__read)((0,r.useState)(0),2),j=H[0],q=H[1],G=function(e){var t=Math.max(e-1,0);return k&&k(E[t])?G(t):t},z=function(e){var t=Math.min(e+1,E.length-1);return k&&k(E[t])?z(t):t},V=function(e){e!==j&&(q(e),function(e){if(t){var n=E[e].peerId,a=t.querySelector('[data-id="'+n+'"]');if(a&&a instanceof HTMLElement){var o=a.offsetTop,r=t.scrollTop;if(o<r)t.scrollTop=o;else{var i=t.offsetHeight,s=o+a.offsetHeight;s>r+i&&(t.scrollTop=s-i)}}}}(e))};(0,r.useEffect)((function(){B&&U.current&&B(U.current.element)}),[]);var K=!!R&&!m,W=(K?[r.createElement(f.default,{selectable:!1,key:"add","data-id":0},r.createElement(_.ListAddControl,{onClick:R},C("mail_new_convo_from_invite")))]:[]).concat(E.map((function(e,t){var n=e.peerId,a=e.photo,o=e.name,i=e.online,s=!!k&&k(e);return r.createElement(g.ConvoPickerRow,{key:n,"data-id":n,peerId:n,photo:a,name:o,online:i,memberCount:(0,p.getChatMemberCount)(e),mode:w,isCasper:(0,v.isCasperChatTab)(e),isSelected:T.includes(n),isActive:t===j,isDisabled:s,onClick:function(){s||M(n)},onMouseEnter:function(){return q(s?-1:t)}})})));return r.createElement("div",(0,o.__assign)({className:D,onMouseLeave:function(){return q(-1)},style:O},x),r.createElement(l.BlockSearchInput,{value:m,onChange:A,onKeyDown:function(e){switch(e.which||e.keyCode){case h.ARROW_UP:V(G(j)),e.preventDefault();break;case h.ARROW_DOWN:V(z(j)),e.preventDefault();break;case h.ENTER:M(E[j].peerId),e.preventDefault()}L(e)},placeholder:C("mail_top_search"),autoFocus:!0,key:"search",ref:U}),I&&r.createElement(c.default,{className:"ConvoPicker__stub",key:"loading"},r.createElement(u.default,null)),!I&&m&&0===E.length&&r.createElement(c.default,{className:"ConvoPicker__stub",key:"no-results"},C("mail_im_search_empty_chats")),!I&&(E.length>0||K)&&r.createElement(d.default,{virtualized:!0,className:"ConvoPicker__results",loadMore:N,hasMore:!1,ref:function(e){var n=i.findDOMNode(e);n&&n instanceof HTMLElement&&(t=n)},key:"results"},W))}},61580:(e,t,n)=>{"use strict";n.d(t,{ConvoPickerRow:()=>g});var a=n(570655),o=n(667294),r=n(483295),i=n(787255),s=n(919316),l=n(597903),c=n(413374),u=n(654857),d=n(406042),h=n(25432),m=n(726271),g=function(e){var t=e.peerId,n=e.name,g=e.photo,v=e.online,p=e.memberCount,f=e.mode,_=void 0===f?c.convoPickerMode.DEFAULT:f,C=e.isSelected,b=e.isDisabled,I=e.isActive,E=e.isCasper,S=e.className,w=(0,a.__rest)(e,["peerId","name","photo","online","memberCount","mode","isSelected","isDisabled","isActive","isCasper","className"]),y=function(e,t,n,a){void 0===a&&(a=0);var r=(0,l.isContactPeer)(e);switch(!0){case Array.isArray(n):return o.createElement(u.default,{photos:n});case r:return o.createElement(d.ConversationNoPhoto,{id:e,text:(0,l.getUserInitials)(t),size:"34",specificType:7});default:return o.createElement(h.default,{isOnline:!!a,isMobile:!!m.mobPlatforms[a],title:t,photo:n,onlineSize:"s"})}}(t,n,g,v),T=E?'<span class="ConvoPickerRow__itemTitle ConvoPickerRow__itemTitle--casper">\n        <span class="ConvoPickerRow__itemTitleText">\n          '+n+"\n        </span>\n      </span>":n,k=_===c.convoPickerMode.RADIO?o.createElement("span",{className:(0,r.classNames)("ConvoPickerRow__radio",{"ConvoPickerRow__radio--selected":C})}):void 0,A=(0,r.classNames)("ConvoPickerRow",S,{"ConvoPickerRow--disabled":b});return o.createElement(i.default,(0,a.__assign)({active:I,selectable:!b,canBeHovered:!1,chevron:_===c.convoPickerMode.DEFAULT&&!b,aside:k,className:A},w),o.createElement(s.default,{ignoreDecodeHTML:!0,size:"34",title:o.createElement("span",{dangerouslySetInnerHTML:{__html:T}}),photo:y,description:p,className:"ConvoPickerRow__itemContent"}))}},195477:(e,t,n)=>{"use strict";n.d(t,{UserConvoInviteContainer:()=>L});var a,o=n(570655),r=n(667294),i=n(327012),s=n(150382),l=n(674041),c=n(413374),u=n(179203),d=n(672385),h=n(459554),m=n(654612),g=n(41650),v=n(792110),p=n(917791),f=n(786067),_=n(475234),C=n(407381),b=n(826338),I=n(608490),E=n(475632),S=n(923876),w=n(826542),y=n(957680),T=n(62839),k=n(827749),A=g.default.getLang;!function(e){e[e.PICKER=0]="PICKER",e[e.CREATION=1]="CREATION"}(a||(a={}));var L=function(e){var t=e.user,n=e.store,g=e.onClose,L=e.onInviteSent,M=e.onGoToConvo,P=(0,o.__read)((0,r.useState)(a.PICKER),2),N=P[0],R=P[1],B=(0,o.__read)((0,r.useState)(!function(e){var t,n=e.get(),a=n.chatList||(null===(t=n.dialog_tabs)||void 0===t?void 0:t.all);return Boolean(a&&a.length>0)}(n)),2),F=B[0],O=B[1],x=(0,o.__read)((0,r.useState)(!0),2),D=x[0],U=x[1],H=(0,o.__read)((0,r.useState)(!1),2),j=H[0],q=H[1],G=(0,o.__read)((0,r.useState)(function(e){var t,n=e.get(),a=n.chatList||((null===(t=n.dialog_tabs)||void 0===t?void 0:t.all)||[]).filter(b.isChatPeer);if(a&&a.length>0)return a.map((function(t){return(0,h.getTab)(e,t)}));return[]}(n)),2),z=G[0],V=G[1],K=(0,o.__read)((0,r.useState)(""),2),W=K[0],Y=K[1],$=(0,r.useCallback)((function(e){Y(e.target.value)}),[W]),Q=(0,r.useCallback)((function(){}),[]),J=(0,r.useRef)(null),X=(0,o.__read)((0,I.useHints)(n,z,W,{queryType:w.HintsSearchType.ALL,filterFn:function(e){return(0,b.isChatPeer)(e.peerId)}}),2),Z=X[0],ee=X[1];(0,r.useEffect)((function(){return(0,p.loadConversations)(n.get(),d.ConvoFilters.CHATS,200).then((function(e){var t=e.items;return V((0,S.mergeConvoLists)(z,t)),t})).then((function(e){var t=e.reduce((function(e,t){return e[t.peerId]=t,e}),{});return n.set((function(n){return(0,C.mergeTabs)(n,t).then((function(t){return(0,_.setChatList)(t,e.map((function(e){return e.peerId})))}))}))})).finally((function(){return O(!1)})),(0,E.cancelStackPush)("convo_invite",(function(){})),function(){setTimeout((function(){return(0,E.cancelStackFilter)("convo_invite")}),0)}}),[]);var te=t.inv_name?(0,f.langStr)((0,f.langSex)(t.sex,A("mail_im_invite_user",!0)),"user",t.inv_name):A("mail_convo_invite_title");return r.createElement(r.Fragment,null,N===a.PICKER&&r.createElement(i.UserConvoInviteModal,{title:te,onCloseModal:g,footer:r.createElement(s.ModalFooter,null,r.createElement(l.default,{checked:D,onChange:function(e,t){return U(t)}},A("mail_im_chat_add_members_show_history")))},r.createElement(c.ConvoPicker,{convos:Z.map((function(e){return(0,h.getTab)(n,e.peerId)||e})),searchValue:W,onSearchValueChange:$,onSearchInputKeydown:Q,onConvoSelect:function(e){q(!0),Promise.resolve().then((function(){return n.set((function(n){return(0,u.addNewMember)(e,[t.id],D,n)}))})).then((function(){return L(e)})).then((function(){g(),q(!1)})).catch((function(e){q(!1),(0,m.showFastBox)(A("global_error"),e)}))},checkDisabled:function(e){return!e.canInvite},searchInputGetter:function(e){return J.current=e},isLoading:F||ee&&0===Z.length,style:{height:410},onAddClick:function(){return R(a.CREATION)}})),N===a.CREATION&&r.createElement(y.ChatCreation,{store:n,uploadAvatar:T.uploadConvoPhoto,onClose:g,onBack:function(){return R(a.PICKER)},onCreateChat:function(e){L(e).then((function(){}),(function(){})),g(),(0,k.collectChatCreateStats)(e,"create_chat__create_invite")},onGoToConvo:function(e){M(e),g()},preselectedUsers:[{id:t.id,peerId:t.id,name:t.name,photo:t.photo}]}),j&&r.createElement(v.default,null))}},327012:(e,t,n)=>{"use strict";n.d(t,{UserConvoInviteModal:()=>s});var a=n(667294),o=n(730365),r=n(41650),i=n(743927),s=function(e){var t=e.title,n=e.onCloseModal,s=e.footer,l=e.isWithBackButton,c=void 0!==l&&l,u=e.onBackClick,d=e.children;return a.createElement(o.default,{className:"UserConvoInviteModal",disableBodyScroll:!0,onClose:n},a.createElement(i.ModalHeader,{title:t,onClose:n,backText:c?(0,r.getLang)("global_back"):void 0,onBack:u,className:"UserConvoInviteModal__header"}),a.createElement("div",{className:"UserConvoInviteModal__content"},d),s)}},614413:(e,t,n)=>{"use strict";n.d(t,{mount:()=>c});var a=n(610124),o=n(667294),r=n(973935),i=n(195477);function s(){var e="_im_user_convo_invite",t=document.getElementById(e);if(t)return t;var n=document.createElement("section");return n.setAttribute("id",e),document.body.appendChild(n),n}function l(e){return{unmount:function(){var t=s();t&&r.unmountComponentAtNode(t),(0,a.destroyModule)(e)}}}function c(e,t,n,c){var u=(0,(0,a.createMutations)(l).bindMutations)((0,a.createModule)({handlers:function(){}}));return function(e,t,n,a,l){var c=s();r.render(o.createElement(i.UserConvoInviteContainer,{user:n,store:e,onClose:t.unmount,onInviteSent:a,onGoToConvo:l}),c)}(e,u,t,n,c),u}},57757:(e,t,n)=>{"use strict";n.d(t,{handleUiActionForPeer:()=>L});var a=n(179288),o=n(826338),r=n(597903),i=n(454593),s=n(645523),l=n(786067),c=n(654612),u=n(917791),d=n(982452),h=n(827749),m=n(309756),g=n(222131),v=n(606542),p=n(614413),f=n(778755),_=n(993421),C=n(695724),b=n(386409),I=n(240367),E=n(407381),S=n(850167),w=n(486125),y=n(459554),T=n(968958),k=n(663825),A=n(712860);function L(e,t,n,L,M,P){var N,R,B,F,O,x,D;switch(void 0===P&&(P=function(e){return(0,T.imWeirdLog)("im_ui_action",{error:e},!1)}),L){case a.ConvoAction.CLEAR:var U=(0,y.getTab)(e,M),H=(0,r.showFlushChat)(U,M,(function(){(0,r.cleanHistory)(e,H,t,i.flushHistory,M)}));break;case a.ConvoAction.MEDIA:(0,S.showWiki)({w:"history"+(0,r.convertPeerToUrl)(M)+"_photo"},null,{});break;case a.ConvoAction.CALL_AUDIO:case a.ConvoAction.CALL_VIDEO:(0,r.isCallToPeerAvailable)(e,M)&&(0,r.startCallFromIm)(e,M,L===a.ConvoAction.CALL_VIDEO,[],r.CALL_ENTRY_POINT_HEADER);break;case a.ConvoAction.CALL_APP:(0,r.isCallToPeerAvailable)(e,M)&&(null===(N=window.Calls)||void 0===N?void 0:N.showStartCallModal)&&(0,r.startCallFromIm)(e,M,!1,[],r.CALL_ENTRY_POINT_HEADER,!0);break;case a.ConvoAction.CALL_BY_NAME:(0,r.isCallToPeerAvailable)(e,M)&&(null===(R=window.Calls)||void 0===R?void 0:R.showCallByNamePopup)&&(0,r.startCallFromIm)(e,M,!1,[],r.CALL_ENTRY_POINT_HEADER,!1,!0);break;case a.ConvoAction.SEARCH:null===(F=(B=t()).showSearch)||void 0===F||F.call(B,e);break;case a.ConvoAction.ADD_FRIEND:U=e.get().tabs[M];var j=(0,v.oCacheGet)(e,M);if(!U||!j)return;var q={type:"done_box",text:U.is_subscribed_to_me?(0,l.getLang)("mail_im_friend_added").replace("{name}",j.first_name_gen):(0,l.langSex)(j.sex,(0,l.getLang)("mail_im_friend_request_sent","raw")).replace("{name}",j.first_name)};e.set((function(e){return(0,A.setPeerSubscribedStatus)(M,!1,e)})).then((function(){return e.set(E.setActions)})).then((function(){var n,a,o,r;(0,m.showNotification)(q),null===(a=(n=t()).updateState)||void 0===a||a.call(n,M,e),null===(r=(o=t()).updateActions)||void 0===r||r.call(o,e)})).catch(P);break;case a.ConvoAction.BLOCK_NOTIFY:case a.ConvoAction.BLOCK_COMMUNITY:e.set(i.toggleCommunityMessages.bind(null,!1,M)).then((function(){var t,n;null===(n=null===(t=e.get())||void 0===t?void 0:t.longpoll)||void 0===n||n.push([(0,s.resetPeer)()]),(0,w.showDoneBox)((0,l.getLang)("mail_community_was_blocked"))})).catch(P);break;case a.ConvoAction.ALLOW_COMMUNITY:e.set(i.toggleCommunityMessages.bind(null,!0,M)).then((function(){var t,a;return null===(a=(t=n()).changeActions)||void 0===a?void 0:a.call(t,e)})).catch(P);break;case a.ConvoAction.BLOCK:(0,r.showBlacklistBox)(M,e).once("success",(function(t){var n,a;t.delta&&((0,w.showDoneBox)(t.msg),null===(a=null===(n=e.get())||void 0===n?void 0:n.longpoll)||void 0===a||a.push([(0,s.resetPeer)()]))}));break;case a.ConvoAction.LEAVE:var G=(0,r.showLeaveDialog)(e,M,(function(n){var a,o,l=e.set(i.leaveChat.bind(null,M)).then((function(){return e.set(i.unpinMessageOptimistic.bind(null,M))}));n&&l.then((function(){return(0,r.cleanHistory)(e,G,t,i.flushHistory,M)})).catch(P),G.hide(),null===(o=null===(a=e.get())||void 0===a?void 0:a.longpoll)||void 0===o||o.push([(0,s.resetPeer)()])}));break;case a.ConvoAction.UNREAD:(0,i.markDialogUnread)(M,e.get()).catch(P);break;case a.ConvoAction.RETURN:e.set(i.returnToChat.bind(null,M)).then((function(e){return e.set(i.getPinnedMessage.bind(null,M))})).then(null===(O=t().updateChatTopic)||void 0===O?void 0:O.bind(null,M)).catch((function(e){(0,c.showFastBox)((0,l.getLang)("global_error"),e),P(e)}));break;case a.ConvoAction.MUTE:case a.ConvoAction.UNMUTE:var z=L===a.ConvoAction.MUTE;e.set((function(e){return(0,i.setMutedPeer)(M,z,e)})).then((function(e){var n,a;return null===(a=(n=t()).updateState)||void 0===a?void 0:a.call(n,M,e)})).then((function(){return e.set((function(e){return(0,i.toggleMutePeer)(M,z,-1,e)}))})).catch(P);break;case a.ConvoAction.PIN_CONVO:(0,u.pinConvoHandler)(e.get(),M).catch((function(e){(0,d.showErrorBox)(e),P(e)}));break;case a.ConvoAction.UNPIN_CONVO:(0,u.unpinConvoHandler)(e.get(),M).catch((function(e){(0,d.showErrorBox)(e),P(e)}));break;case a.ConvoAction.CHAT_INVITE:(0,r.inviteUser)(e,M,t,i.setCreationType);break;case a.ConvoAction.USER_INVITE:if((U=(0,y.getTab)(e,M))&&(0,y.isUserConvo)(U)&&U.canBeAddedToChat){(0,h.collectConvoInviteStats)(h.ConvoInviteEntryPoint.DIALOG_ACTIONS,M);(j=(0,o.isContactPeer)(M)?(0,g.makeUserFromUserConvo)(U):(0,v.oCacheGet)(e,M))&&(0,p.mount)(e,j,(function(t){var n;return Promise.resolve(null===(n=e.get().longpoll)||void 0===n?void 0:n.push([(0,s.changePeer)(t,!1,!1,!1,"convo_invite")]))}),(function(t){var n;return null===(n=e.get().longpoll)||void 0===n?void 0:n.push([(0,s.changePeer)(t,!1,!1,!1,"convo_invite")])}))}break;case a.ConvoAction.CREATE_CHAT:U=(0,y.getTab)(e,M);var V=[[M,null==U?void 0:U.tab]];e.set(i.setCreationType.bind(null,"chat",[])).then((function(){var n,a;return null===(a=(n=t()).showCreation)||void 0===a?void 0:a.call(n,e,V)})).catch(P);break;case a.ConvoAction.PIN_HIDE:(0,f.pinnedMessageHide)(e,(0,_.getPeer)(e),t);break;case a.ConvoAction.PIN_UNHIDE:(0,f.pinnedMessageUnHide)(e,(0,_.getPeer)(e),t);break;case a.ConvoAction.UNPIN:(0,f.pinnedMessageUnpin)(e,(0,_.getPeer)(e),t);break;case a.ConvoAction.SETTINGS:null===(D=(x=n()).showSettings)||void 0===D||D.call(x,e);break;case a.ConvoAction.DISABLE_BUSINESS_NOTIFY:var K=(U=(0,y.getTab)(e,M))&&(0,y.isChatConvo)(U)&&U.ownerId;if(!K)return;var W=new c.MessageBox({title:(0,l.getLang)("mail_business_notify_disable_box_title")}).content((0,C.getTemplate)("sImBusinessNotifyDisableBoxContent",{text:(0,l.getLang)("mail_business_notify_disable_box_text")})).addButton((0,l.getLang)("mail_business_notify_disable_box_button"),(function(n){(0,b.lockButton)(n),e.set((function(e){return(0,E.setConvoBusinessNotifyEnabled)(e,M,!1)})).then((function(){return e.set(E.setActions)})).then((function(){var n,a,o,r;return null===(a=(n=t()).updateActions)||void 0===a||a.call(n,e),null===(r=(o=t()).updateState)||void 0===r||r.call(o,M,e),(0,I.denyMessagesFromGroup)({group_id:-K})})).then((function(){W.hide()})).catch(P)})).show();break;case a.ConvoAction.ENABLE_BUSINESS_NOTIFY:var Y=(U=(0,y.getTab)(e,M))&&(0,y.isChatConvo)(U)&&U.ownerId;if(!Y)return;e.set((function(e){return(0,E.setConvoBusinessNotifyEnabled)(e,M,!0)})).then((function(){return e.set(E.setActions)})).then((function(){var n,a,o,r;return null===(a=(n=t()).updateActions)||void 0===a||a.call(n,e),null===(r=(o=t()).updateState)||void 0===r||r.call(o,M,e),(0,I.allowMessagesFromGroup)({group_id:-Y})})).catch(P);break;case a.ConvoAction.ARCHIVE:if(!(U=(0,y.getTab)(e,M)))break;e.set((function(e){return(0,i.updateFolderState)(M,a.FOLDER_MASKS[a.FOLDER_ARCHIVE],k.SET_DIRECTORIES,!0,!1,(0,d.unpackStore)(e))})).then((function(){return e.set(E.setActions)})).then((function(){var n,a,o,r;null===(a=(n=t()).updateActions)||void 0===a||a.call(n,e),null===(r=(o=t()).removePeer)||void 0===r||r.call(o,e,M)})).then((function(){return(0,I.archiveConversation)({peer_id:M})})).catch(P);break;case a.ConvoAction.UNARCHIVE:if(!(U=(0,y.getTab)(e,M)))break;e.set((function(e){return(0,i.updateFolderState)(M,a.FOLDER_MASKS[a.FOLDER_ARCHIVE],k.RESET_DIRECTORIES,!0,!1,(0,d.unpackStore)(e))})).then((function(){return e.set(E.setActions)})).then((function(){var n,o,r,i,l,c;null===(o=(n=t()).updateActions)||void 0===o||o.call(n,e),null===(i=(r=t()).removePeer)||void 0===i||i.call(r,e,M);var u=(0,d.unpackStore)(e);u.active_tab!==a.ConvoListFolder.ARCHIVE||(null===(l=u.dialog_tabs[a.ConvoListFolder.ARCHIVE])||void 0===l?void 0:l.length)||null===(c=null==u?void 0:u.longpoll)||void 0===c||c.push([(0,s.changeTab)(a.ConvoListFolder.ALL)])})).then((function(){return(0,I.unarchiveConversation)({peer_id:M})})).catch(P)}}},203524:(e,t,n)=>{"use strict";n.d(t,{useIndexer:()=>i});var a=n(570655),o=n(337057),r=n(667294),i=function(e,t,n){var i=(0,r.useRef)(null);i.current=i.current?i.current:new o.VkIndexer(e,t);var s=i.current,l=(0,r.useCallback)((function(e){return e.reduce((function(e,t){return e[n(t)]=!0,e}),{})}),[]),c=(0,a.__read)((0,r.useState)(e),2),u=c[0],d=c[1],h=(0,a.__read)((0,r.useState)(l(e)),2),m=h[0],g=h[1];return(0,r.useEffect)((function(){var t=l(e),a=e.filter((function(e){return!m[n(e)]})),o=u.filter((function(e){return!t[n(e)]}));(a.length||o.length)&&(a.forEach((function(e){s.add(e)})),o.forEach((function(e){s.remove(e)})),d(e),g(t))}),[e]),s}},608490:(e,t,n)=>{"use strict";n.d(t,{useHints:()=>h});var a=n(570655),o=n(667294),r=n(191040),i=n(917791),s=n(203524),l=n(923876),c=n(826542),u=(0,r.debouncedPromise)(i.searchHints,300),d=function(){return!0};function h(e,t,n,r){var i=(0,a.__read)((0,o.useState)(t),2),h=i[0],m=i[1],g=(0,a.__read)((0,o.useState)(!1),2),v=g[0],p=g[1],f=(0,o.useRef)(n),_=(0,o.useCallback)((function(e){return e.name}),[]),C=(0,o.useCallback)((function(e){return e.peerId}),[]),b=(0,s.useIndexer)(t,_,C),I=(0,o.useCallback)((function(e){return r.filterFn?e.filter(r.filterFn):e}),[r.filterFn]);return(0,o.useEffect)((function(){if(f.current=n,n){var a=b.search(n),o=a.map((function(e){return e.peerId}));m(I(a)),p(!0),u(n,o,r.queryType||c.HintsSearchType.ALL,r,e.get()).then((function(e){f.current===n&&(m((0,l.mergeConvoLists)(a,e,r.filterFn||d)),p(!1))})).catch((function(){}))}else m(I(t)),p(!1)}),[n,t]),[h,v]}},62839:(e,t,n)=>{"use strict";n.d(t,{uploadConvoPhoto:()=>i});var a=n(40906),o=n(486125),r=n(826542);function i(){var e=2e9+Math.round((0,a.rand)(1e6,2e6));return new Promise((function(t){window.cur.recieveCropResult=function(n){window.cur.recieveCropResult=!1,(0,r.ownerPhoto)(JSON.parse(n).data[0],e).then((function(e){var a=Array.isArray(e)?e[0]:e;t({photo:a,photoData:n}),(0,o.curBox)()&&(0,o.curBox)().hide(!0)}),(function(){}))},window.Page.ownerPhoto(e),(0,o.curBox)().setOptions({onHideAttempt:function(e){return e||t({}),!0}})}))}},672385:(e,t,n)=>{"use strict";var a;n.d(t,{ConvoFilters:()=>a}),function(e){e.ALL="all",e.ARCHIVE="archive",e.UNREAD="unread",e.IMPORTANT="important",e.UNANSWERED="unanswered",e.MESSAGE_REQUEST="message_request",e.BUSINESS_NOTIFY="business_notify",e.CHATS="chats"}(a||(a={}))}}]);try{stManager.done("dist/519619abdcf4517008a7b23855d1f7bd.a09d9414fe2a02789877.js")}catch(e){}